<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Central - Dual Infodose</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="assets/icons/icon-192.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Montserrat',sans-serif;
      background: linear-gradient(to bottom, #000, #1a1a1a);
      color:#fff; height:100vh; overflow:hidden;
      display:flex; align-items:flex-start; justify-content:center;
      padding-top: 250px; /* empurra conteúdo pra baixo */
      position:relative; opacity:0;
      animation:fadeInBody 1.8s ease forwards;
    }
    @keyframes fadeInBody { to { opacity:1; } }
    @keyframes fadeOutBody { to { opacity:0; } }

    #particles-js { position:absolute; inset:0; z-index:0; }

    .center-group {
      z-index:1;
      display:flex; flex-direction:column;
      align-items:center; gap:1rem;
      cursor:pointer; padding:20px;
    }
    .logo-container {
      width:180px;
      animation:glow 3s ease-in-out infinite alternate;
      transition:transform .8s;
      pointer-events:none;
    }
    .logo-container object { width:100%; display:block; }
    @keyframes glow {
      from { filter: drop-shadow(0 0 10px #0ff) drop-shadow(0 0 20px #f0f); }
      to   { filter: drop-shadow(0 0 25px #0ff) drop-shadow(0 0 35px #f0f); }
    }
    .infodose {
      font-size:1.6em; font-weight:300;
      opacity:0; animation:fadeIn 1.5s forwards 1s;
      pointer-events:none;
    }
    .infodose strong { font-weight:600; }
    @keyframes fadeIn { to { opacity:1; } }

    .login-container {
      width:280px;
      padding:1rem;
      background:rgba(0,0,0,0.7);
      border:1px solid rgba(255,255,255,0.2);
      border-radius:10px;
      backdrop-filter:blur(8px);
      display:flex; flex-direction:column; gap:1rem;
      opacity:0; pointer-events:none;
      transition:opacity .3s;
    }
    .login-container.active {
      opacity:1; pointer-events:auto;
    }
    .login-container input {
      width:100%; background:transparent;
      border:none; border-bottom:1px solid rgba(255,255,255,0.5);
      padding:0.5rem 0; font-size:1em; font-weight:300;
      color:#fff; outline:none; text-align:center;
    }
    .login-container input::placeholder {
      color:rgba(255,255,255,0.6); font-weight:300;
    }
    .login-container button {
      width:100%;
      background:transparent; border:1px solid #0ff;
      border-radius:6px; padding:0.6rem 0;
      font-size:1em; font-weight:600; color:#0ff;
      cursor:pointer; transition:all .25s;
    }
    .login-container button:hover {
      background:#0ff; color:#000; border-color:#0ff;
    }
    .logout-area button {
      width:100%;
      background:transparent; border:1px solid #f55;
      border-radius:6px; padding:0.6rem 0;
      font-size:1em; font-weight:600; color:#f55;
      cursor:pointer; transition:all .25s;
    }
    .logout-area button:hover {
      background:#f55; color:#000; border-color:#f55;
    }
    #buyTokens button {
      width:100%;
      background:transparent; border:1px solid #0f0;
      border-radius:6px; padding:0.6rem 0;
      font-size:1em; font-weight:600; color:#0f0;
      cursor:pointer; transition:all .25s;
    }
    #buyTokens button:hover {
      background:#0f0; color:#000; border-color:#0f0;
    }

    @media(max-width:360px) {
      .logo-container { width:140px; }
      .infodose { font-size:1.3em; }
      .login-container { width:90vw; }
    }
    @media(max-height: 700px) {
  .center-group {
    margin-top: 20px;
  }
}
@media(min-height: 900px) {
  .center-group {
    margin-top: 80px;
  }
}
  </style>
</head>
<body>
<svg style="display:none"><filter id="distort">
  <feTurbulence baseFrequency="0.012" numOctaves="2" result="turb"/>
  <feDisplacementMap in="SourceGraphic" in2="turb" scale="24"/>
</filter></svg>

<audio id="transitionSound" src="assets/sounds/suave_portal.mp3" preload="auto"></audio>
<div id="particles-js"></div>

<div class="center-group" id="unlockArea">
  <div class="logo-container">
    <object data="assets/icons/3D_logo_Dual_Infodose_10.svg" type="image/svg+xml"></object>
  </div>
  <div class="infodose">dual.<strong>Infodose</strong></div>

  <div class="login-container" id="loginBox">
    <form id="loginForm">
      <input type="text" id="user" placeholder="Usuário" required>
      <input type="password" id="pass" placeholder="Senha" required>
      <button type="submit">Entrar</button>
    </form>
    <div class="logout-area" style="display:none;">
      <button id="logoutBtn">Desconectar</button>
    </div>
    <!-- Botão de comprar IFT (ajustado com contador e estilo único) -->
<div id="buyTokens" style="display:none; flex-direction:column; align-items:center; gap:1rem;">
  <div id="iftBalance" style="color:#0f0; font-weight:600; font-size:1.1em;">IFTs: 0</div>
  <button id="buyIFTBtn">Adicionar 999 IFTs</button>
</div>

<footer id="footerIFT" style="position:fixed; bottom:10px; left:50%; transform:translateX(-50%);
  font-size:0.9em; color:#0f0; opacity:0.7; display:none;">
  Restam <span id="iftLeft">0</span> IFTs
</footer>

<script>
const unlockArea = document.getElementById('unlockArea');
const loginBox   = document.getElementById('loginBox');
const loginForm  = document.getElementById('loginForm');
const userInput  = document.getElementById('user');
const passInput  = document.getElementById('pass');
const logoutBtn  = document.getElementById('logoutBtn');
const logoutArea = loginBox.querySelector('.logout-area');
const buyArea    = document.getElementById('buyTokens');
const buyIFTBtn  = document.getElementById('buyIFTBtn');
const balanceBox = document.getElementById('iftBalance');
const footerIFT  = document.getElementById('footerIFT');
const iftLeftEl  = document.getElementById('iftLeft');
const storedKey  = 'infodose_user';

let iftTimer = null;
let lastInteraction = Date.now();

function updateIFTDisplay() {
  const ift = parseInt(localStorage.getItem('IFT') || '0');
  balanceBox.textContent = `IFTs: ${ift}`;
  iftLeftEl.textContent = ift;
  if (ift > 0) {
    footerIFT.style.display = 'block';
  } else {
    footerIFT.style.display = 'none';
  }
}

function showLogin() {
  logoutArea.style.display = 'none';
  buyArea.style.display    = 'none';
  loginForm.style.display  = 'flex';
  loginBox.classList.add('active');
}
function showLogout() {
  loginForm.style.display  = 'none';
  logoutArea.style.display = 'flex';
  buyArea.style.display    = 'none';
  loginBox.classList.add('active');
  updateIFTDisplay();
}
function showBuy() {
  loginForm.style.display  = 'none';
  logoutArea.style.display = 'none';
  buyArea.style.display    = 'flex';
  loginBox.classList.add('active');
  updateIFTDisplay();
}

function checkAccess(user) {
  if (user.toLowerCase() === 'kodux') return goToIndex();

  const isReturningUser = localStorage.getItem('firstAccess') === 'true';
  if (!isReturningUser) {
    localStorage.setItem('firstAccess', 'true');
    return showBuy();
  }

  const ift = parseInt(localStorage.getItem('IFT') || '0');
  if (ift > 0) {
    startIFTCountdown();
    return goToIndex();
  } else {
    return showBuy();
  }
}

function goToIndex() {
  const snd = document.getElementById('transitionSound');
  snd.volume = 0;
  snd.play();
  gsap.to('.logo-container', { scale:0, duration:1, ease:'power3.out', filter:'url(#distort)' });
  gsap.to('.infodose', { opacity:0, duration:0.6 });
  setTimeout(() => document.body.style.animation = 'fadeOutBody 1s forwards', 600);
  setTimeout(() => window.location.href = 'index.html', 1400);
}

function addIFT(amount) {
  let current = parseInt(localStorage.getItem('IFT') || '0');
  current += amount;
  localStorage.setItem('IFT', current);
  updateIFTDisplay();
}

function reduceIFT(amount) {
  let current = parseInt(localStorage.getItem('IFT') || '0');
  if (current >= amount) {
    current -= amount;
    localStorage.setItem('IFT', current);
    updateIFTDisplay();
    if (current < 1) {
      alert('Seus IFTs acabaram.');
      window.location.reload();
    }
  }
}

function startIFTCountdown() {
  if (iftTimer) clearInterval(iftTimer);

  iftTimer = setInterval(() => {
    const now = Date.now();
    if (now - lastInteraction >= 144000) {
      reduceIFT(369);
      lastInteraction = Date.now();
    }
  }, 15000); // verifica a cada 15 segundos
}

document.addEventListener('mousemove', () => lastInteraction = Date.now());
document.addEventListener('keydown', () => lastInteraction = Date.now());
document.addEventListener('click',    () => lastInteraction = Date.now());

unlockArea.addEventListener('click', () => {
  const user = localStorage.getItem(storedKey);
  if (user) {
    checkAccess(user);
  } else {
    showLogin();
    gsap.fromTo(loginBox, { y:-20 }, { y:0, duration:0.6, ease:'power2.out' });
  }
});

loginForm.addEventListener('submit', e => {
  e.preventDefault();
  const u = userInput.value.trim(), p = passInput.value.trim();
  if (!u || !p) return alert('Preencha login e senha');
  localStorage.setItem(storedKey, u);
  checkAccess(u);
});

logoutBtn.addEventListener('click', () => {
  localStorage.removeItem(storedKey);
  localStorage.removeItem('IFT');
  clearInterval(iftTimer);
  footerIFT.style.display = 'none';
  showLogin();
});

buyIFTBtn.addEventListener('click', () => {
  addIFT(999);
  alert('999 IFTs adicionados!');
});

window.addEventListener('load', () => {
  if (localStorage.getItem(storedKey)) {
    showLogout();
    startIFTCountdown();
  }
});
</script>
</body>
</html>