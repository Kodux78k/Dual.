# n8n - NÃ³ Python Script
# Entrada esperada: nome, telefone, descricao
import re

input_data = items[0]['json']
descricao = input_data.get('descricao', '').lower()

# ClassificaÃ§Ã£o bÃ¡sica por palavras-chave
pendencia = "Outros"

if any(kw in descricao for kw in ["escritura", "nÃ£o registrada", "registro"]):
    pendencia = "Escritura nÃ£o registrada"
elif any(kw in descricao for kw in ["heranÃ§a", "irmÃ£o", "partilha", "inventÃ¡rio"]):
    pendencia = "HeranÃ§a / InventÃ¡rio"
elif any(kw in descricao for kw in ["itbi", "imposto", "transmissÃ£o"]):
    pendencia = "ITBI / TributaÃ§Ã£o"
elif any(kw in descricao for kw in ["documento", "regularizar", "papelada"]):
    pendencia = "DocumentaÃ§Ã£o geral"
elif any(kw in descricao for kw in ["iptu", "dÃ©bito", "irregular"]):
    pendencia = "IPTU Irregular"

# Mensagem para WhatsApp
mensagem = f"""
OlÃ¡ {input_data.get('nome', 'amigo')}! ğŸ™‹â€â™‚ï¸

Vi sua mensagem sobre regularizaÃ§Ã£o.

Meu pai Ã© engenheiro e especialista nisso hÃ¡ mais de 15 anos em Sorocaba.

ğŸ“Œ Assunto identificado: {pendencia}

Ele pode te ajudar com tudo â€” desde a documentaÃ§Ã£o atÃ© resolver na prefeitura.

Posso te passar o WhatsApp direto dele?

GratidÃ£o! ğŸ™
"""

return [{
    "json": {
        "nome": input_data.get("nome"),
        "telefone": input_data.get("telefone"),
        "descricao": input_data.get("descricao"),
        "classificacao": pendencia,
        "mensagem": mensagem
    }
}]
